<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inscriptions - Gestion Classe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #000; color: #eee; padding: 10px; margin: 0; }
        
        .card-input { display: none; }
        .card-label {
            display: flex; align-items: center; justify-content: center;
            background: #1a1a1a; border: 1px solid #333;
            padding: 8px 4px; border-radius: 0.75rem; cursor: pointer;
            font-size: 0.65rem; font-weight: 700; text-transform: uppercase;
            transition: all 0.2s;
        }
        .card-input:checked + .card-label { background: #fff; border-color: #fff; color: #000; transform: scale(0.98); }

        .level-column { background: rgba(24, 24, 27, 0.6); border: none; border-radius: 1.25rem; padding: 10px; height: fit-content; }

        .text-m { color: #2563eb; } 
        .text-f { color: #db2777; } 
        
        .student-item { background: #fff; padding: 6px 10px; border-radius: 0.75rem; display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .btn-nav { font-weight: 800; padding: 12px 4px; border-radius: 50px; font-size: 10px; text-align: center; border: none; cursor: pointer; flex: 1; }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        
        <div class="flex items-center justify-between py-2 mb-2">
            <a href="index.html" id="btn-retour" class="flex items-center justify-center w-8 h-8 rounded-full shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            <h1 class="text-lg font-black tracking-tighter uppercase">Inscriptions</h1>
            <div class="w-8"></div> 
        </div>
        
        <div class="max-w-md mx-auto bg-zinc-900 border border-zinc-800 rounded-[1.5rem] p-4 mb-6 shadow-2xl">
            <form id="eleveForm" class="flex flex-col gap-3">
                <input type="text" id="nomComplet" placeholder="Prénom NOM" 
                    class="bg-black border border-zinc-700 text-white text-sm rounded-lg p-3 outline-none focus:border-white" required>
                
                <div class="grid grid-cols-2 gap-2">
                    <label><input type="radio" name="sexe" value="m" class="card-input" checked><div class="card-label">Garçon</div></label>
                    <label><input type="radio" name="sexe" value="f" class="card-input"><div class="card-label">Fille</div></label>
                </div>

                <div class="grid grid-cols-3 gap-1.5">
                    <label><input type="radio" name="niveau" value="CP" class="card-input"><div class="card-label">CP</div></label>
                    <label><input type="radio" name="niveau" value="CE1" class="card-input"><div class="card-label">CE1</div></label>
                    <label><input type="radio" name="niveau" value="CE2" class="card-input" checked><div class="card-label">CE2</div></label>
                    <label><input type="radio" name="niveau" value="CM1" class="card-input"><div class="card-label">CM1</div></label>
                    <label><input type="radio" name="niveau" value="CM2" class="card-input"><div class="card-label">CM2</div></label>
                    <label><input type="radio" name="niveau" value="AUTRE" class="card-input"><div class="card-label">Autre</div></label>
                </div>

                <button type="submit" id="btn-submit" class="font-black py-3 rounded-full uppercase text-xs active:scale-95 transition-transform mt-1">Enregistrer</button>

                <div class="pt-3 border-t border-zinc-800 text-center">
                    <label id="label-import" class="text-[9px] font-bold  block mb-1">Importer un fichier .txt (Prénom;NOM;sexe;niveau)</label>
                    <input type="file" id="fileInput" accept=".txt,.csv" class="text-[9px] text-zinc-600">
                </div>
            </form>
        </div>

        <div id="listeContainer"></div>

        <div class="max-w-md mx-auto flex gap-4 mt-6 mb-10">
            <button onclick="toutEffacer()" class="btn-nav bg-red-500 text-red-50 text-[9px] uppercase">RàZ de la liste</button>
        </div>
    </div>

    <script>
        const themePrefs = JSON.parse(localStorage.getItem('theme_tuiles')) || {};
        const couleurInscr = themePrefs.inscr || 'lime';

        function appliquerCouleurs() {
            const h1 = document.querySelector('h1');
            const btnRetour = document.getElementById('btn-retour');
            const btnSubmit = document.getElementById('btn-submit');
            const labelImport = document.getElementById('label-import');

            if (h1) h1.classList.add(`text-${couleurInscr}-500`);
            if (labelImport) labelImport.classList.add(`text-${couleurInscr}-500`);

            if (btnRetour) {
                btnRetour.classList.add(`bg-${couleurInscr}-600`);
                btnRetour.classList.add(`border`, `border-${couleurInscr}-400/30`);
            }
            if (btnSubmit) {
                btnSubmit.classList.add(`bg-${couleurInscr}-500`);
                if(['yellow', 'lime', 'amber', 'cyan'].includes(couleurInscr)) {
                    btnSubmit.classList.add('text-black');
                } else {
                    btnSubmit.classList.add('text-white');
                }
            }
        }

        let eleves = JSON.parse(localStorage.getItem('maListeEleves')) || [];

        function formaterIdentite(prenom, nom) {
            const p = prenom.trim();
            const n = nom.trim().toUpperCase();
            return p.charAt(0).toUpperCase() + p.slice(1).toLowerCase() + " " + n;
        }

        document.getElementById('eleveForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const saisie = document.getElementById('nomComplet').value.trim().split(" ");
            const prenom = saisie[0] || "";
            const nom = saisie.slice(1).join(" ") || "";
            const sexe = document.querySelector('input[name="sexe"]:checked').value;
            const niveau = document.querySelector('input[name="niveau"]:checked').value;
            
            eleves.push({ id: Date.now(), identite: formaterIdentite(prenom, nom), sexe, niveau });
            sauvegarder();
            e.target.reset();
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const lignes = e.target.result.split(/\r?\n/);
                lignes.forEach(l => {
                    const clean = l.trim();
                    if (!clean) return;
                    const p = clean.split(';'); 
                    if(p.length >= 4) {
                        eleves.push({
                            id: Date.now() + Math.random(),
                            identite: formaterIdentite(p[0], p[1]),
                            sexe: p[2].trim().toLowerCase(),
                            niveau: p[3].trim().toUpperCase()
                        });
                    }
                });
                sauvegarder();
            };
            reader.readAsText(file);
        });

        function sauvegarder() {
            localStorage.setItem('maListeEleves', JSON.stringify(eleves));
            render();
        }

        function render() {
            const container = document.getElementById('listeContainer');
            container.innerHTML = "";
            if (eleves.length === 0) return;

            const groupes = {};
            eleves.forEach(el => {
                const niv = el.niveau.toUpperCase();
                if (!groupes[niv]) groupes[niv] = [];
                groupes[niv].push(el);
            });

            const nomsNiveaux = Object.keys(groupes).sort();
            
            if (nomsNiveaux.length === 2) {
                container.className = "grid grid-cols-2 gap-3 items-start";
            } else if (nomsNiveaux.length >= 3) {
                container.className = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 items-start";
            } else {
                container.className = "flex flex-col gap-4 max-w-md mx-auto";
            }

            nomsNiveaux.forEach(niv => {
                const col = document.createElement('div');
                col.className = "level-column";
                const textColClass = `text-${couleurInscr}-500`;
                
                col.innerHTML = `
                    <h3 class="text-[11px] font-black uppercase mb-1 text-center tracking-widest pb-1 ${textColClass}">
                        ${niv} — ${groupes[niv].length}
                    </h3>`;
                
                const list = document.createElement('div');
                groupes[niv].sort((a,b) => a.identite.localeCompare(b.identite)).forEach(el => {
                    list.innerHTML += `
                        <div class="student-item">
                            <span class="text-[9px] font-bold pr-2 text-${el.sexe} whitespace-normal break-words leading-tight">${el.identite}</span>
                            <button onclick="supprimer(${el.id})" class="opacity-40 hover:opacity-100 transition-opacity p-1 text-zinc-400 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>`;
                });
                col.appendChild(list);
                container.appendChild(col);
            });
        }

        function supprimer(id) {
            if(confirm("Supprimer cet élève ?")) {
                eleves = eleves.filter(e => e.id !== id);
                sauvegarder();
            }
        }

        function toutEffacer() {
            if(confirm("Attention : Supprimer toute la liste d'élèves ?")) {
                eleves = [];
                sauvegarder();
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            appliquerCouleurs();
            render();
        });
    </script>
</body>
</html>